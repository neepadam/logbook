<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Anaesthetic Logbook</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#071024" />
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Anaesthetic Logbook â€” PWA</h1>
        <div class="muted">Offline, CSV import/export, duplicate & batch-create, charts</div>
      </div>
      <div style="margin-left:auto" class="controls">
        <button id="installBtn" style="display:none">Install App</button>
        <button id="exportCsv">Export CSV</button>
        <button id="importCsvBtn">Import CSV</button>
        <input type="file" id="csvFileInput" accept="text/csv" style="display:none"/>
      </div>
    </header>

    <main class="card">
      <form id="caseForm">
        <div class="date-row">
          <label class="small">Date</label>
          <input type="date" id="date" required />
          <button type="button" id="todayBtn">Today</button>
          <button type="button" id="yesterdayBtn">Yesterday</button>
        </div>

        <div class="form-grid">
          <div>
            <label>Session</label>
            <select id="session"><option>AM</option><option>PM</option><option>Evening</option><option>Night</option></select>
          </div>
          <div>
            <label>Specialty</label>
            <select id="specialty"></select>
          </div>
          <div>
            <label>Operation</label>
            <input id="operation" required />
          </div>
          <div>
            <label>Priority</label>
            <select id="priority"><option>Elective</option><option>Expedited</option><option>Urgent</option><option>Immediate</option></select>
          </div>
          <div>
            <label>ASA grade</label>
            <select id="asa"><option>1</option><option>2</option><option>3</option><option>4</option></select>
          </div>
          <div>
            <label>Age</label>
            <input id="age" type="number" min="0" />
          </div>
          <div>
            <label>Anaesthetic type</label>
            <select id="anaestheticType"><option>Volatile</option><option>TIVA</option><option>Sedation</option><option>Regional only</option></select>
          </div>
          <div>
            <label>Airway used</label>
            <select id="airway"><option>LMA</option><option>ETT</option><option>Mask</option><option>DLT</option><option>Trache</option></select>
          </div>
          <div>
            <label>Regional technique</label>
            <select id="regional" multiple size="3"></select>
            <input id="regionalCustom" placeholder="Add regional (comma separated)" />
          </div>
          <div>
            <label>Procedures performed</label>
            <div class="procedures">
              <label class="pill"><input type="checkbox" value="Arterial line" class="proc"/> Arterial line</label>
              <label class="pill"><input type="checkbox" value="Central line" class="proc"/> Central line</label>
              <label class="pill"><input type="checkbox" value="Vas Cath" class="proc"/> Vas Cath</label>
              <label class="pill"><input type="checkbox" value="Gas induction" class="proc"/> Gas induction</label>
              <label class="pill"><input type="checkbox" value="Nasal intubation" class="proc"/> Nasal intubation</label>
              <label class="pill"><input type="checkbox" value="Fibreoptic awake" class="proc"/> Fibreoptic awake</label>
              <label class="pill"><input type="checkbox" value="Fibreoptic asleep" class="proc"/> Fibreoptic asleep</label>
            </div>
          </div>
          <div>
            <label>Teaching</label>
            <select id="teaching"><option>Trainee</option><option>Novice</option><option>Med student</option><option>Anaesthetic associate</option><option>Other</option></select>
          </div>
          <div>
            <label>Location</label>
            <select id="location"><option>Pinderfields</option><option>Dewsbury</option><option>Pontefract</option><option>Methley</option><option>Elland</option><option>Other</option></select>
          </div>
          <div style="grid-column:1/-1">
            <label>Incidents / Notes</label>
            <textarea id="incidents" rows="3"></textarea>
          </div>
        </div>

        <div class="form-actions">
          <button id="saveBtn" type="submit">Save case</button>
          <button id="duplicateBtn" type="button">Duplicate last</button>
          <button id="batchDupBtn" type="button">Batch create</button>
          <input id="batchCount" type="number" min="2" max="50" style="width:70px" placeholder="#" />
        </div>
      </form>

      <div class="list card" style="margin-top:12px">
        <div class="list-head">
          <div><strong>Logged cases</strong> <span id="casesCount" class="muted">(0)</span></div>
          <div class="controls"><button id="clearAll">Clear all</button><button id="showCharts">Show charts</button></div>
        </div>
        <div id="casesList" class="cases-list"></div>
      </div>

      <div id="chartsModal" class="card" style="display:none;margin-top:12px">
        <h3>Charts</h3>
        <canvas id="casesPerMonth" width="400" height="200"></canvas>
        <canvas id="anaestheticTypeChart" width="400" height="200" style="margin-top:12px"></canvas>
        <div style="margin-top:8px"><button id="closeCharts">Close charts</button></div>
      </div>

    </main>
    <footer>
      This app stores your data in your browser (local device). Use <strong>Export CSV</strong> to backup or transfer data.
    </footer>
  </div>

  <!-- Libraries (prefer local copies for offline support). You can use CDN here as a quick start.) -->
  <script src="/localforage.min.js"></script>
  <script src="/papaparse.min.js"></script>
  <script src="/chart.umd.js"></script>
  <script src="/app.js"></script>
</body>
</html>
